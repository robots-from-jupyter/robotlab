parameters:
  name: Linux
  condaSubdir: linux-64

steps:
  - script: >
      python -m scripts.build conda
      lunr
      robotframework
      robotframework-lint
      robotframework-seleniumlibrary
      robotkernel
      robotlab
    displayName: Build Conda Packages

  - script: python -m scripts.build constructor
    displayName: Build Constructor

  - ${{ if eq(parameters.name, 'Windows') }}:
      script: conda install -v _artifacts\conda-bld\win-64\chromedriver*
      displayName: Install ChromeDriver

  - ${{ if not(eq(parameters.name, 'Windows')) }}:
      script: conda install -v _artifacts/conda-bld/$CONDASUBDIR/chromedriver*
      displayName: Install ChromeDriver

  - script: python -m scripts.test
    displayName: Test

  - task: PublishTestResults@2
    displayName: Publish Test Results
    inputs:
      testResultsFiles: _artifacts/test_output/**/*.xunit.xml
    condition: always()

  - task: PublishBuildArtifacts@1
    displayName: Publish Robot Logs
    inputs:
      PathtoPublish: _artifacts/test_output
      ArtifactName: ${{ parameters.name }} tests
    condition: always()

  - task: PublishBuildArtifacts@1
    displayName: Publish Installer
    inputs:
      PathtoPublish: _artifacts/constructor
      ArtifactName: ${{ parameters.name }} installer
    condition: succeeded()
